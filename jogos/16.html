<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refloreste as Matas Ciliares</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            background: linear-gradient(to bottom, #87CEEB 0%, #98D8E8 100%);
        }

        #menu, #game, #gameOver, #victory, #phaseTransition {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        #menu {
            display: flex;
            background: linear-gradient(135deg, #2E7D32 0%, #66BB6A 100%);
            color: white;
        }

        #menu h1 {
            font-size: 3em;
            margin-bottom: 20px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
            text-align: center;
        }

        #menu p {
            font-size: 1.2em;
            max-width: 600px;
            text-align: center;
            margin: 20px;
            line-height: 1.6;
        }

        #phaseTransition {
            background: linear-gradient(135deg, #1B5E20 0%, #4CAF50 100%);
            color: white;
            z-index: 1000;
        }

        #phaseTransition h2 {
            font-size: 3em;
            margin-bottom: 20px;
            animation: bounce 0.6s ease-in-out;
        }

        #phaseTransition p {
            font-size: 1.5em;
            margin: 10px;
            animation: fadeIn 0.8s ease-in;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .btn {
            padding: 15px 40px;
            font-size: 1.3em;
            background: #FFA726;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .btn:hover {
            background: #FB8C00;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.4);
        }

        #game {
            background: linear-gradient(to bottom, #87CEEB 0%, #E8F5E9 50%, #8BC34A 100%);
        }

        #gameCanvas {
            background: linear-gradient(to bottom, #E3F2FD 0%, #C8E6C9 100%);
            cursor: crosshair;
        }

        #hud {
            position: absolute;
            top: 20px;
            width: 800px;
            display: flex;
            justify-content: space-between;
            color: white;
            font-size: 1.2em;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .hud-item {
            background: rgba(46, 125, 50, 0.8);
            padding: 10px 20px;
            border-radius: 10px;
            border: 2px solid #FFA726;
        }

        #gameOver, #victory {
            background: rgba(0, 0, 0, 0.9);
            color: white;
        }

        #gameOver h2 {
            font-size: 3em;
            color: #f44336;
            margin-bottom: 20px;
        }

        #victory h2 {
            font-size: 3em;
            color: #4CAF50;
            margin-bottom: 20px;
        }

        .stats {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px;
            max-width: 600px;
        }

        .stats p {
            margin: 10px 0;
            font-size: 1.1em;
        }

        .phase-stat {
            margin: 5px 0;
            padding-left: 20px;
        }
    </style>
</head>
<body>
    <div id="menu">
        <h1>üå≥ Refloreste as Matas Ciliares üå≥</h1>
        <p>
            As matas ciliares protegem os rios e nascentes! Sua miss√£o √© restaurar essas √°reas 
            plantando √°rvores nativas e removendo todo o lixo. 
            A cada fase, o desafio aumenta!
        </p>
        <p style="font-size: 1em; margin-top: 30px;">
            üå± Clique nas √°reas marrons para plantar √°rvores<br>
            üóëÔ∏è Arraste o lixo at√© a lixeira no canto da tela<br>
            ‚è±Ô∏è Complete antes do tempo acabar!
        </p>
        <button class="btn" onclick="startGame()">Iniciar Jogo</button>
    </div>

    <div id="game">
        <div id="hud">
            <div class="hud-item">Fase: <span id="level">1</span></div>
            <div class="hud-item">√Årvores: <span id="trees">0</span>/<span id="treesNeeded">5</span></div>
            <div class="hud-item">Lixo: <span id="trash">0</span>/<span id="trashNeeded">3</span></div>
            <div class="hud-item">Tempo: <span id="timer">60</span>s</div>
        </div>
        <canvas id="gameCanvas" width="800" height="600"></canvas>
    </div>

    <div id="phaseTransition">
        <h2 id="phaseTitle">üéâ Fase Completa! üéâ</h2>
        <p id="phaseMessage"></p>
        <p id="nextPhaseInfo" style="margin-top: 30px; font-size: 1.2em;"></p>
    </div>

    <div id="gameOver">
        <h2>üò¢ Tempo Esgotado!</h2>
        <p style="font-size: 1.3em; margin: 20px;">A mata ciliar precisa da sua ajuda!</p>
        <button class="btn" onclick="restartGame()">Tentar Novamente</button>
        <button class="btn" onclick="backToMenu()">Menu Principal</button>
    </div>

    <div id="victory">
        <h2>üéâ Parab√©ns! Voc√™ Zerou o Jogo! üéâ</h2>
        <div class="stats" id="finalStats"></div>
        <button class="btn" onclick="restartGame()">Jogar Novamente</button>
        <button class="btn" onclick="backToMenu()">Menu Principal</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        let gameState = {
            level: 1,
            treesPlanted: 0,
            trashRemoved: 0,
            treesNeeded: 5,
            trashNeeded: 3,
            timeLimit: 60,
            timeRemaining: 60,
            plantSpots: [],
            trashItems: [],
            draggedTrash: null,
            phaseStats: [],
            phaseStartTime: 0,
            timerInterval: null,
            animationOffset: 0,
            clouds: []
        };

        function initClouds() {
            gameState.clouds = [];
            for (let i = 0; i < 5; i++) {
                gameState.clouds.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * 100 + 20,
                    speed: Math.random() * 0.5 + 0.2,
                    size: Math.random() * 40 + 30
                });
            }
        }

        function showScreen(screenId) {
            document.querySelectorAll('#menu, #game, #gameOver, #victory, #phaseTransition').forEach(el => {
                el.style.display = 'none';
            });
            document.getElementById(screenId).style.display = 'flex';
        }

        function startGame() {
            gameState = {
                level: 1,
                treesPlanted: 0,
                trashRemoved: 0,
                treesNeeded: 5,
                trashNeeded: 3,
                timeLimit: 60,
                timeRemaining: 60,
                plantSpots: [],
                trashItems: [],
                draggedTrash: null,
                phaseStats: [],
                phaseStartTime: Date.now(),
                timerInterval: null,
                animationOffset: 0,
                clouds: []
            };
            initClouds();
            initLevel();
            showScreen('game');
            startTimer();
            animate();
        }

        function initLevel() {
            gameState.plantSpots = [];
            gameState.trashItems = [];
            gameState.treesPlanted = 0;
            gameState.trashRemoved = 0;
            gameState.phaseStartTime = Date.now();

            for (let i = 0; i < gameState.treesNeeded; i++) {
                gameState.plantSpots.push({
                    x: Math.random() * (canvas.width - 80) + 40,
                    y: Math.random() * 200 + 350,
                    planted: false
                });
            }

            const trashTypes = ['üóëÔ∏è', 'ü•´', 'üß¥', 'üçæ', 'üì¶', 'üõí'];
            for (let i = 0; i < gameState.trashNeeded; i++) {
                gameState.trashItems.push({
                    x: Math.random() * (canvas.width - 60) + 30,
                    y: Math.random() * 400 + 100,
                    type: trashTypes[Math.floor(Math.random() * trashTypes.length)],
                    removed: false
                });
            }

            updateHUD();
            draw();
        }

        function updateHUD() {
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('trees').textContent = gameState.treesPlanted;
            document.getElementById('treesNeeded').textContent = gameState.treesNeeded;
            document.getElementById('trash').textContent = gameState.trashRemoved;
            document.getElementById('trashNeeded').textContent = gameState.trashNeeded;
            document.getElementById('timer').textContent = gameState.timeRemaining;
        }

        function startTimer() {
            if (gameState.timerInterval) clearInterval(gameState.timerInterval);
            
            gameState.timerInterval = setInterval(() => {
                gameState.timeRemaining--;
                updateHUD();

                if (gameState.timeRemaining <= 0) {
                    clearInterval(gameState.timerInterval);
                    endGame(false);
                }
            }, 1000);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            gameState.clouds.forEach(cloud => {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.beginPath();
                ctx.arc(cloud.x, cloud.y, cloud.size, 0, Math.PI * 2);
                ctx.arc(cloud.x + cloud.size * 0.6, cloud.y, cloud.size * 0.8, 0, Math.PI * 2);
                ctx.arc(cloud.x + cloud.size * 1.2, cloud.y, cloud.size * 0.9, 0, Math.PI * 2);
                ctx.fill();
            });

            const waterGradient = ctx.createLinearGradient(0, 0, 0, 150);
            waterGradient.addColorStop(0, '#64B5F6');
            waterGradient.addColorStop(0.5, '#42A5F5');
            waterGradient.addColorStop(1, '#1E88E5');
            ctx.fillStyle = waterGradient;
            ctx.fillRect(0, 0, canvas.width, 150);
            

            ctx.strokeStyle = 'rgba(129, 212, 250, 0.6)';
            ctx.lineWidth = 3;
            for (let i = 0; i < 8; i++) {
                ctx.beginPath();
                const waveOffset = Math.sin(gameState.animationOffset * 0.8 + i * 0.5) * 4;
                ctx.arc(i * 100 + 50, 60 + waveOffset, 25, 0, Math.PI, false);
                ctx.stroke();
            }
            
    
            ctx.strokeStyle = 'rgba(187, 222, 251, 0.4)';
            ctx.lineWidth = 2;
            for (let i = 0; i < 8; i++) {
                ctx.beginPath();
                const waveOffset = Math.sin(gameState.animationOffset + i * 0.8) * 3;
                ctx.arc(i * 100, 90 + waveOffset, 20, 0, Math.PI, false);
                ctx.stroke();
            }


            ctx.fillStyle = 'rgba(255, 255, 255, 0.15)';
            for (let i = 0; i < 6; i++) {
                const shimmer = Math.sin(gameState.animationOffset * 2 + i) * 0.1 + 0.1;
                ctx.globalAlpha = shimmer;
                ctx.fillRect(i * 140 + 20, 30, 80, 10);
            }
            ctx.globalAlpha = 1;

            const soilGradient = ctx.createLinearGradient(0, 150, 0, 400);
            soilGradient.addColorStop(0, '#A1887F');
            soilGradient.addColorStop(0.3, '#8D6E63');
            soilGradient.addColorStop(0.7, '#795548');
            soilGradient.addColorStop(1, '#6D4C41');
            ctx.fillStyle = soilGradient;
            ctx.fillRect(0, 150, canvas.width, 250);

            ctx.fillStyle = 'rgba(62, 39, 35, 0.3)';
            for (let i = 0; i < 50; i++) {
                const x = (i * 67) % canvas.width;
                const y = 150 + ((i * 43) % 250);
                const size = 3 + (i % 5);
                ctx.fillRect(x, y, size, size);
            }

            const transitionGradient = ctx.createLinearGradient(0, 380, 0, 420);
            transitionGradient.addColorStop(0, '#6D4C41');
            transitionGradient.addColorStop(0.5, '#7CB342');
            transitionGradient.addColorStop(1, '#689F38');
            ctx.fillStyle = transitionGradient;
            ctx.fillRect(0, 380, canvas.width, 40);

            
            const grassGradient = ctx.createLinearGradient(0, 400, 0, 600);
            grassGradient.addColorStop(0, '#7CB342');
            grassGradient.addColorStop(0.5, '#689F38');
            grassGradient.addColorStop(1, '#558B2F');
            ctx.fillStyle = grassGradient;
            ctx.fillRect(0, 420, canvas.width, 180);

            ctx.fillStyle = 'rgba(76, 175, 80, 0.4)';
            for (let i = 0; i < 30; i++) {
                const x = i * 27 + (Math.sin(gameState.animationOffset * 0.5 + i) * 2);
                ctx.fillRect(x, 420, 2, 18);
                ctx.fillRect(x + 8, 425, 2, 15);
                ctx.fillRect(x + 16, 422, 2, 20);
            }

            ctx.fillStyle = 'rgba(102, 187, 106, 0.6)';
            for (let i = 0; i < 25; i++) {
                const x = i * 32 + 10 + (Math.sin(gameState.animationOffset * 0.7 + i) * 3);
                ctx.fillRect(x, 430, 3, 22);
                ctx.fillRect(x + 10, 435, 3, 18);
            }

            ctx.fillStyle = '#81C784';
            for (let i = 0; i < 20; i++) {
                const x = i * 40 + (Math.sin(gameState.animationOffset + i) * 3);
                ctx.fillRect(x, 440, 3, 25);
                ctx.fillRect(x + 10, 445, 3, 20);
                ctx.fillRect(x + 20, 442, 3, 28);
            }

            const flowerColors = ['#FFEB3B', '#FF9800', '#E91E63', '#9C27B0'];
            for (let i = 0; i < 12; i++) {
                const x = (i * 71 + 25) % canvas.width;
                const y = 450 + (i % 3) * 30;
                const bounce = Math.sin(gameState.animationOffset + i * 0.5) * 1;
                ctx.fillStyle = flowerColors[i % 4];
                ctx.beginPath();
                ctx.arc(x, y + bounce, 4, 0, Math.PI * 2);
                ctx.fill();
            }

            ctx.fillStyle = '#8B4513';
            ctx.fillRect(680, 480, 100, 100);
            ctx.strokeStyle = '#654321';
            ctx.lineWidth = 4;
            ctx.strokeRect(680, 480, 100, 100);
            ctx.font = '60px Arial';
            ctx.fillText('üóëÔ∏è', 695, 545);

            gameState.plantSpots.forEach((spot, index) => {
                if (!spot.planted) {
                    ctx.fillStyle = '#6D4C41';
                    ctx.beginPath();
                    ctx.arc(spot.x, spot.y, 25, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = 'white';
                    ctx.font = '20px Arial';
                    ctx.fillText('üå±', spot.x - 10, spot.y + 7);
                } else {
                    const sway = Math.sin(gameState.animationOffset + index * 0.5) * 2;
                    drawTree(spot.x + sway, spot.y);
                }
            });

            gameState.trashItems.forEach((item, index) => {
                if (!item.removed) {
                    const bounce = Math.sin(gameState.animationOffset + index) * 2;
                    ctx.font = '40px Arial';
                    ctx.fillText(item.type, item.x - 20, item.y + 15 + bounce);
                }
            });

            if (gameState.draggedTrash) {
                ctx.font = '40px Arial';
                ctx.fillText(gameState.draggedTrash.type, gameState.draggedTrash.x - 20, gameState.draggedTrash.y + 15);
            }
        }

        function animate() {
            if (document.getElementById('game').style.display === 'flex') {
                gameState.animationOffset += 0.05;
                
                gameState.clouds.forEach(cloud => {
                    cloud.x += cloud.speed;
                    if (cloud.x > canvas.width + cloud.size * 2) {
                        cloud.x = -cloud.size * 2;
                    }
                });

                draw();
                requestAnimationFrame(animate);
            }
        }

        function drawTree(x, y) {
            ctx.fillStyle = '#5D4037';
            ctx.fillRect(x - 5, y - 20, 10, 30);

            ctx.fillStyle = '#4CAF50';
            ctx.beginPath();
            ctx.arc(x, y - 25, 20, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(x - 15, y - 15, 15, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(x + 15, y - 15, 15, 0, Math.PI * 2);
            ctx.fill();
        }

        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            gameState.plantSpots.forEach(spot => {
                if (!spot.planted) {
                    const dist = Math.sqrt((x - spot.x) ** 2 + (y - spot.y) ** 2);
                    if (dist < 25) {
                        spot.planted = true;
                        gameState.treesPlanted++;
                        updateHUD();
                        checkLevelComplete();
                        draw();
                    }
                }
            });
        });

        canvas.addEventListener('mousedown', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            gameState.trashItems.forEach(item => {
                if (!item.removed) {
                    if (x >= item.x - 20 && x <= item.x + 20 && y >= item.y - 20 && y <= item.y + 20) {
                        gameState.draggedTrash = item;
                    }
                }
            });
        });

        canvas.addEventListener('mousemove', (e) => {
            if (gameState.draggedTrash) {
                const rect = canvas.getBoundingClientRect();
                gameState.draggedTrash.x = e.clientX - rect.left;
                gameState.draggedTrash.y = e.clientY - rect.top;
                draw();
            }
        });

        canvas.addEventListener('mouseup', (e) => {
            if (gameState.draggedTrash) {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                if (x >= 680 && x <= 780 && y >= 480 && y <= 580) {
                    gameState.draggedTrash.removed = true;
                    gameState.trashRemoved++;
                    updateHUD();
                    checkLevelComplete();
                }

                gameState.draggedTrash = null;
                draw();
            }
        });

        function checkLevelComplete() {
            if (gameState.treesPlanted >= gameState.treesNeeded && 
                gameState.trashRemoved >= gameState.trashNeeded) {
                
                clearInterval(gameState.timerInterval);
                
                const timeSpent = gameState.timeLimit - gameState.timeRemaining;
                gameState.phaseStats.push({
                    level: gameState.level,
                    timeSpent: timeSpent
                });

                if (gameState.level >= 5) {
                    endGame(true);
                } else {
                    showPhaseTransition();
                }
            }
        }

        function showPhaseTransition() {
            const messages = [
                "Excelente trabalho! A mata est√° mais saud√°vel! üå≥",
                "Continue assim! Os animais est√£o voltando! ü¶ú",
                "Incr√≠vel! O rio est√° mais limpo! üíß",
                "Voc√™ √© um guardi√£o da natureza! üåø",
                "√öltima fase! A mata ciliar precisa de voc√™! üèÜ"
            ];

            const nextLevel = gameState.level + 1;
            document.getElementById('phaseTitle').textContent = `üéâ Fase ${gameState.level} Completa! üéâ`;
            document.getElementById('phaseMessage').textContent = messages[gameState.level - 1];
            document.getElementById('nextPhaseInfo').innerHTML = `
                <strong>Pr√≥xima Fase ${nextLevel}:</strong><br>
                üå± Plantar ${gameState.treesNeeded + 3} √°rvores<br>
                üóëÔ∏è Remover ${gameState.trashNeeded + 2} itens de lixo<br>
                ‚è±Ô∏è Tempo: ${Math.max(30, gameState.timeLimit - 10)} segundos
            `;

            showScreen('phaseTransition');

            setTimeout(() => {
                gameState.level++;
                gameState.treesNeeded += 3;
                gameState.trashNeeded += 2;
                gameState.timeLimit = Math.max(30, gameState.timeLimit - 10);
                gameState.timeRemaining = gameState.timeLimit;
                initLevel();
                showScreen('game');
                startTimer();
                animate();
            }, 4000);
        }

        function endGame(victory) {
            clearInterval(gameState.timerInterval);

            if (victory) {
                let totalTime = 0;
                let statsHTML = '<h3>üìä Estat√≠sticas Finais</h3>';
                statsHTML += '<p style="font-size: 1.2em; color: #4CAF50;">Voc√™ restaurou com sucesso as matas ciliares!</p>';
                
                gameState.phaseStats.forEach(stat => {
                    totalTime += stat.timeSpent;
                    statsHTML += `<p class="phase-stat">üå≥ Fase ${stat.level}: ${stat.timeSpent} segundos</p>`;
                });

                statsHTML += `<p style="margin-top: 20px; font-size: 1.3em; color: #FFA726;">‚è±Ô∏è Tempo Total: ${totalTime} segundos</p>`;
                statsHTML += `<p style="margin-top: 10px; color: #66BB6A;">üèÜ Total de √Årvores Plantadas: ${gameState.phaseStats.length * 5 + (gameState.level - gameState.phaseStats.length) * 3}</p>`;

                document.getElementById('finalStats').innerHTML = statsHTML;
                showScreen('victory');
            } else {
                showScreen('gameOver');
            }
        }

        function restartGame() {
            startGame();
        }

        function backToMenu() {
            showScreen('menu');
        }

        showScreen('menu');
    </script>
</body>
</html>